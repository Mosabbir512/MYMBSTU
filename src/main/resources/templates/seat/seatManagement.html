<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - MBSTU</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(#E0FFFF, #E0FFFF, #E0FFFF 100%);
            min-height: 100vh;
        }

        /* Updated Map Container Styles */
        .map-container {
            height: 500px;
            width: 100%;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 1rem;
            position: relative;
            overflow: hidden;
        }

        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .map-control-btn {
            background: white;
            border: none;
            border-radius: 2px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            padding: 5px 10px;
            font-size: 14px;
        }

        .map-control-btn:hover {
            background: #f1f1f1;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .map-container {
                height: 350px;
            }
        }

        .navbar {
            width: 100%;
            padding: 1rem 2rem;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            z-index: 1000;
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #2c3e50;
            font-weight: 500;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            position: relative;
        }

        .nav-links a:hover {
            color: #00CED1;
            background: rgba(0, 206, 209, 0.1);
        }

        .logout-btn {
            background: #dc3545;
            color: white !important;
            padding: 0.5rem 1.5rem !important;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #c82333 !important;
            color: white !important;
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
            border-radius: 8px;
            overflow: hidden;
            top: 100%;
            left: 0;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown-content a {
            color: #2c3e50;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background 0.3s;
        }

        .dropdown-content a:hover {
            background-color: rgba(0, 206, 209, 0.1);
            color: #00CED1;
        }

        .hero-section {
            padding: 6rem 2rem 2rem;
            text-align: center;
            background: linear-gradient(rgba(0, 206, 209, 0.8), rgba(0, 206, 209, 0.8)), url('/images/hall-bg.jpg');
            background-size: cover;
            color: white;
        }

        .hero-section h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .hero-section p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Section Styles */
        .section {
            padding: 2rem;
            max-width: 1200px;
            margin: 2rem auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .section h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: #2c3e50;
        }

        /* Carousel Styles */
        .hall-carousel {
            position: relative;
            height: 500px;
            overflow: hidden;
            margin-bottom: 2rem;
            border-radius: 10px;
        }

        .hall-carousel img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            border-radius: 10px;
        }

        .hall-carousel img.active {
            opacity: 1;
        }

        /* Services Grid */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .service-card {
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .service-card h3 {
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .service-card a {
            text-decoration: none;
            color: #00CED1;
            font-weight: 500;
        }

        /* Admin Dashboard Styles */
        .admin-dashboard {
            margin-bottom: 2rem;
        }

        /* Table Styles */
        .application-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        .application-table th,
        .application-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .application-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .application-table tr:hover {
            background-color: #f5f5f5;
        }

        .application-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .approve-btn {
            background: #28a745;
            color: white;
        }

        .approve-btn:hover {
            background: #218838;
        }

        .reject-btn {
            background: #dc3545;
            color: white;
        }

        .reject-btn:hover {
            background: #c82333;
        }

        /* Pagination Styles */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination a {
            color: #2c3e50;
            padding: 8px 16px;
            text-decoration: none;
            border: 1px solid #ddd;
            margin: 0 4px;
            border-radius: 4px;
        }

        .pagination a.active {
            background-color: #00CED1;
            color: white;
            border: 1px solid #00CED1;
        }

        .pagination a:hover:not(.active) {
            background-color: #ddd;
        }

        /* Location Section */
        .location-section {
            margin-top: 2rem;
        }

        .map-container {
            height: 400px;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1rem;
        }

        .circle {
            width: 16px;
            height: 16px;
            border: 2px solid #3498db;
            border-radius: 50%;
            background-color: transparent;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 0 auto;
        }

        .circle.filled {
            background-color: #3498db;
        }


        .admin-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .admin-section h3 {
            align-content: center;
            margin-bottom: 1rem;
            color: #2c3e50;
            border-bottom: 2px solid #00CED1;
            padding-bottom: 0.5rem;
        }


        .stat-card h4 {
            color: #6c757d;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00CED1;
        }

        .view-btn {
            background: #17a2b8;
            color: white;
        }

        .view-btn:hover {
            background: #138496;
        }

        .verify-btn {
            background: #28a745;
            color: white;
        }

        .verify-btn:hover {
            background: #218838;
        }

        .result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .result-item:hover {
            background-color: #f5f5f5;
        }

        #tokenSearchResults {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background: white;
            z-index: 1000;
        }
    </style>
</head>
<body>
<nav class="navbar">
    <a href="/home" class="nav-brand">MYMBSTU</a>
    <div class="nav-links">
        <a href="/home">Home</a>

        <!-- About Hall Link with Dropdown -->
        <div class="dropdown">
            <a href="/about_hall_man">About Hall</a>
            <div class="dropdown-content">
                <a href="/about_hall_man#about-section">About Hall</a>
                <th:block th:unless="${user != null && (user.role == 'PROVOST' || user.role == 'STAF' || user.role=='DOCTOR')}">
                    <a href="/about_hall_man#services-section">Services</a>
                </th:block>
                <th:block th:if="${user != null && (user.role == 'PROVOST' || user.role == 'STAF')}">
                    <a href="/about_hall_man#admin-section">Admin Dashboard</a>
                </th:block>
                <a href="/about_hall_man#location-section">Location & Direction</a>
            </div>
        </div>

        <!-- Management Dropdown for Provost -->
        <th:block th:if="${user != null && user.role == 'PROVOST'}">
            <div class="dropdown">
                <a href="/provost/seat-approval">Management</a>
                <div class="dropdown-content">
                    <a href="/provost/seat-approval">Seat Approval</a>
                    <a href="/provost/allottees">Allottees</a>
                    <a href="/provost/paymentConfirmapplicant">Payment List</a>
                    <a href="/provost/unpaymentList">Unpayment List</a>
                    <a href="/provost/seat-cancellation">Seat Cancellation</a>
                </div>
            </div>
        </th:block>

        <!-- Notice Link -->
        <th:block th:if="${user != null}">
            <a th:if="${user.role == 'PROVOST' || user.role == 'STAF'}"
               href="/notice/admin/noticegen">Notices Gen</a>
            <a th:unless="${user.role == 'PROVOST' || user.role == 'STAF'}"
               href="/notice">Notice</a>
        </th:block>

        <!-- User Profile and Logout -->
        <th:block th:if="${user != null}">
            <a href="/profile" th:text="${user.username}"></a>
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="logout-btn">Logout</button>
            </form>
        </th:block>

        <!-- Login Link for non-logged in users -->
        <th:block th:unless="${user != null}">
            <a href="/login">Login</a>
        </th:block>
    </div>
</nav>

<!-- Hero Section -->
<div class="hero-section">
    <h1>Welcome to MBSTU Hall Management</h1>
    <p th:if="${user != null &&('PROVOST'.equalsIgnoreCase(user.role)  || user.role== 'STAF')}">Admin Dashboard
        - Manage all hall applications</p>
    <p th:unless="${user != null && ('provost'.equalsIgnoreCase(user.role)  || user.role== 'STAF')}">Your
        one-stop solution for managing hall accommodations, services, and more.</p>
</div>

<!-- About Hall Section -->
<div id="about-section" class="section">
    <h2>About Hall</h2>

    <!-- Carousel -->
    <div class="hall-carousel">
        <img src="/images/hall1.jpg" alt="Hall 1" class="active">
        <img src="/images/hall2.jpg" alt="Hall 2">
        <img src="/images/hall3.jpg" alt="Hall 3">
        <img src="/images/hall4.jpg" alt="Hall 4">
        <img src="/images/hall5.jpg" alt="Hall 5">
    </div>

    <div>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin-bottom: 2rem;">
            <div style="padding: 1rem; background: #f8f9fa; border-radius: 10px;">
                <h3>Provost's Advice</h3>
                <p>Stay disciplined and focus on your studies. The hall is your second home, so take care of it.</p>
            </div>
            <div style="padding: 1rem; background: #f8f9fa; border-radius: 10px;">
                <h3>Supervisor's Advice</h3>
                <p>Always follow the rules and regulations of the hall. Respect your fellow students and staff.</p>
            </div>
        </div>
        <p>MBSTU Hall is one of the premier residential facilities for students at Mawlana Bhashani Science and
            Technology University. Established in 2003, the hall provides accommodation for over 500 students with
            modern amenities and a conducive environment for academic excellence.</p>
    </div>
</div>

<!-- Services Section - Only for non-admin users -->
<th:block th:unless="${user != null && (user.role=='PROVOST'  || user.username == 'STAF')}">
    <div id="services-section" class="section">
        <h2>Our Services</h2>
        <div class="services-grid">
            <div class="service-card" onclick="window.location.href='/seat-allocation'">
                <h3>Seat Allocation</h3>
                <p>Check your seat allocation status and details.</p>
                <a href="/seat-allocation">View Details</a>
            </div>
            <div class="service-card" onclick="window.location.href='/applySeat'">
                <h3>Apply for Seat</h3>
                <p>Apply for a new seat allocation.</p>
                <a href="/applySeat">Apply Now</a>
            </div>
            <div class="service-card" onclick="window.location.href='/applyID'">
                <h3>ID Card Services</h3>
                <p>Apply for a new or replacement ID card.</p>
                <a href="/applyID">Apply Now</a>
            </div>
            <div class="service-card" onclick="window.location.href='/applyAttestation'">
                <h3>Attestation Paper</h3>
                <p>Apply for an attestation paper.</p>
                <a href="/applyAttestation">Apply Now</a>
            </div>
            <div class="service-card" onclick="window.location.href='/applyLostCertificate'">
                <h3>Lost Certificate</h3>
                <p>Apply for a lost certificate.</p>
                <a href="/applyLostCertificate">Apply Now</a>
            </div>
            <div class="service-card" onclick="window.location.href='/token'">
                <h3>Hall Token Collection</h3>
                <p>Collect your hall token.</p>
                <a href="/token">Collect Now</a>
            </div>
        </div>
    </div>
</th:block>

<!-- Admin Dashboard Section - Only for admin users -->
<th:block th:if="${user != null && (('PROVOST'.equalsIgnoreCase(user.role)) || ('staf'.equalsIgnoreCase(user.role)))}">
    <div id="admin-section" class="section">
        <h2>Admin Dashboard</h2>
        <div class="admin-dashboard">
            <h3>Pending Seat Applications</h3>

            <!-- In the search and filter form section -->
            <div style="margin-bottom: 20px;">
                <form id="searchForm" th:action="@{/about_hall_man}" method="get" style="display: flex; gap: 10px;">
                    <input type="hidden" name="scrollToAdmin" value="true">
                    <input type="text" name="search" th:value="${currentSearch}"
                           placeholder="Search by student ID or name"
                           style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                    <button type="submit"
                            style="padding: 8px 16px; background-color: #00CED1; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Search
                    </button>
                    <a th:href="@{/about_hall_man(scrollToAdmin=true)}"
                       style="padding: 8px 16px; background-color: #6c757d; color: white; border-radius: 4px; text-decoration: none; display: flex; align-items: center;">
                        Reset
                    </a>
                    <!-- Add this new button -->
                    <button type="button" onclick="generatePendingSeatPDF()"
                            style="padding: 8px 16px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Generate PDF
                    </button>
                </form>
            </div>

            <!-- Seat Applications Table -->
            <div class="application-list">
                <table class="application-table">
                    <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Father's Income</th>
                        <th>Address</th>
                        <th>Reason</th>
                        <th>Hall Name</th>
                        <th>Applied On</th>
                        <th>Viva</th>

                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="request : ${seatRequests.content}">
                        <td th:text="${request.user.id}">2023001</td>
                        <td th:text="${request.user.username}">John Doe</td>
                        <td th:text="${request.familyIncome}">50000</td>
                        <td th:text="${request.permanentAddress}">123 Main St</td>
                        <td th:text="${request.reason}">Need accommodation</td>
                        <td th:text="${request.user.hallName}">SRH</td>
                        <td th:text="${#temporals.format(request.createdAt, 'yyyy-MM-dd HH:mm')}">2023-06-15</td>
                        <td>
                            <div class="circle"
                                 th:classappend="${request.vivaStatus} ? 'filled' : ''"
                                 th:data-id="${request.id}"
                                 onclick="toggleVivaStatus(this)"></div>
                        </td>
                        <td>
                <span th:switch="${request.user.hallName}">
                    <span th:case="'Jananeta Abdul Mannan Hall'" th:text="${jamnAvailable}">0</span>
                    <span th:case="'Bangabandhu Sheikh Mujibur Rahman Hall'" th:text="${bsmrhAvailable}">0</span>
                    <span th:case="'Sheikh Rasel Hall'" th:text="${srhAvailable}">0</span>
                    <span th:case="'Shahid Ziaur Rahman Hall'" th:text="${szrhAvailable}">0</span>
                    <span th:case="'Alema Khatun Bhashani Hall'" th:text="${akbhAvailable}">0</span>
                    <span th:case="'Bangamata Sheikh Fazilatunnesa Mujib Hall'" th:text="${bsfmAvailable}">0</span>
                    <span th:case="'Shaheed Janani Jahanara Imam Hall'" th:text="${sjjihAvailable}">0</span>
                    <span th:case="*">N/A</span>
                </span>
                        </td>
                    </tr>
                    <tr th:if="${seatRequests.content.size() == 0}">
                        <td colspan="7" style="text-align: center;">No pending applications found</td>
                    </tr>
                    </tbody>
                </table>

                <!-- Pagination -->
                <div class="pagination" th:if="${seatRequests.totalPages > 1}">
                    <a th:if="${!seatRequests.first}"
                       th:href="@{/about_hall_man(page=1, search=${currentSearch}, scrollToAdmin=true)}">&laquo;&laquo;</a>
                    <a th:if="${!seatRequests.first}"
                       th:href
                               ="@{/about_hall_man(page=${seatRequests.number}, search=${currentSearch}, scrollToAdmin=true)}">&laquo;</a>

                    <a th:each="i : ${#numbers.sequence(1, seatRequests.totalPages)}"
                       th:href="@{/about_hall_man(page=${i}, search=${currentSearch}, scrollToAdmin=true)}"
                       th:classappend="${i == seatRequests.number + 1} ? 'active' : ''"
                       th:text="${i}">1</a>

                    <a th:if="${!seatRequests.last}"
                       th:href="@{/about_hall_man(page=${seatRequests.number + 2}, search=${currentSearch}, scrollToAdmin=true)}">&raquo;</a>
                    <a th:if="${!seatRequests.last}"
                       th:href="@{/about_hall_man(page=${seatRequests.totalPages}, search=${currentSearch}, scrollToAdmin=true)}">&raquo;&raquo;</a>
                </div>

                <div style="margin-top: 10px; color: #6c757d;">
                    Showing <span th:text="${seatRequests.number * seatRequests.size + 1}">1</span> to
                    <span th:text="${seatRequests.number * seatRequests.size + seatRequests.numberOfElements}">10</span>
                    of
                    <span th:text="${seatRequests.totalElements}">100</span> applications
                </div>
            </div>

            <!-- ID Card Applications Section -->
            <div class="admin-section">
                <h3>ID Card Applications</h3>
                <table class="application-table">
                    <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Applied On</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="app : ${idCardApplications}">
                        <td th:text="${app.user.id}">2023001</td>
                        <td th:text="${app.user.username}">John Doe</td>
                        <td th:text="${app.idCardType}">NEW</td>
                        <td th:text="${#temporals.format(app.applicationDate, 'yyyy-MM-dd')}">2023-06-15</td>
                        <td th:text="${app.status}">PENDING</td>
                        <td class="application-actions">
                            <button class="action-btn approve-btn"
                                    th:data-id="${app.id}"
                                    onclick="approveIdCard(this)">Approve
                            </button>
                            <!--                            <button class="action-btn reject-btn"-->
                            <!--                                    th:data-id="${app.id}"-->
                            <!--                                    onclick="rejectIdCard(this)">Reject</button>-->
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Attestation Applications Section -->
            <div class="admin-section">
                <h3>Attestation Applications</h3>
                <table class="application-table">
                    <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Reason</th>
                        <th>Applied On</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="app : ${attestationApplications}">
                        <td th:text="${app.user.id}">2023001</td>
                        <td th:text="${app.user.username}">John Doe</td>
                        <td th:text="${#strings.abbreviate(app.reason, 50)}">Attestation reason...</td>
                        <td th:text="${#temporals.format(app.requestDate, 'yyyy-MM-dd')}">2023-06-15</td>
                        <td th:text="${app.status}">PENDING</td>
                        <td class="application-actions">
                            <button class="action-btn approve-btn"
                                    th:data-id="${app.id}"
                                    onclick="approveAttestation(this)">Approve
                            </button>
                            <!--                            <button class="action-btn reject-btn"-->
                            <!--                                    th:data-id="${app.id}"-->
                            <!--                                    onclick="rejectAttestation(this)">Reject</button>-->
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Lost Certificate Applications Section -->
            <div class="admin-section">
                <h3>Lost Certificate Applications</h3>
                <table class="application-table">
                    <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Applied On</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="app : ${lostCertificateApplications}">
                        <td th:text="${app.user.id}">2023001</td>
                        <td th:text="${app.user.username}">John Doe</td>
                        <td th:text="${#temporals.format(app.requestDate, 'yyyy-MM-dd')}">2023-06-15</td>
                        <td th:text="${app.status}">PENDING</td>
                        <td class="application-actions">
                            <button class="action-btn approve-btn"
                                    th:data-id="${app.id}"
                                    onclick="approveLostCertificate(this)">Approve
                            </button>
                            <button class="action-btn reject-btn"
                                    th:data-id="${app.id}"
                                    onclick="rejectLostCertificate(this)">Reject
                            </button>
                            <!--                            <button class="action-btn view-btn"-->
                            <!--                                    th:data-gdpath="${app.gdPhotoPath}"-->
                            <!--                                    onclick="viewGD(this)">View GD</button>-->
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>


            <!-- Token Search Section -->
            <div class="admin-section">
                <h3>Token Verification</h3>
                <div style="margin-bottom: 20px;">
                    <div class="search-box">
                        <input type="text" id="tokenSearchInput" placeholder="Start typing token number..."
                               style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #ddd;"
                               onkeyup="liveTokenSearch()">
                    </div>
                </div>

                <div id="tokenSearchResults" style="display: none; max-height: 400px; overflow-y: auto;
         margin-top: 10px; background: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    <!-- Results will appear here -->
                </div>

                <div id="tokenDetails"
                     style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4>Token Details</h4>
                    <div id="tokenDetailContent"></div>
                </div>
            </div>

        </div>
    </div>
</th:block>

<!-- Location Section -->
<div id="location-section" class="section">
    <h2>Location & Direction</h2>
    <div>
        <p>The MBSTU Hall is located on the main campus of Mawlana Bhashani Science and Technology University in
            Tangail, Bangladesh.</p>
        <p><strong>Address:</strong> Santosh, Tangail-1902, Bangladesh</p>
        <p><strong>How to reach:</strong> From Dhaka, take a bus to Tangail and then a local transport to Santosh. The
            university is well-marked and easily accessible.</p>

        <!--        <div class="map-container">-->
        <!--            &lt;!&ndash; This would be replaced with an actual map embed &ndash;&gt;-->
        <!--            <p style="font-size: 1.2rem; color: #666;">Map would be displayed here</p>-->
        <!--        </div>-->
    </div>
</div>

<script>
    // Carousel functionality
    let currentIndex = 0;
    const images = document.querySelectorAll('.hall-carousel img');

    function rotateImages() {
        // Hide current image
        images[currentIndex].classList.remove('active');

        // Move to next image
        currentIndex = (currentIndex + 1) % images.length;

        // Show next image
        images[currentIndex].classList.add('active');
    }

    // Rotate images every 5 seconds
    setInterval(rotateImages, 5000);

    // Smooth scroll for anchor links - modified to handle admin section
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            // Check if this is an admin link within the admin section
            const isAdminLink = this.closest('.admin-dashboard') !== null;

            if (!isAdminLink) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;

                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80, // Adjust for navbar height
                        behavior: 'smooth'
                    });
                }
            }
        });
    });

    // Make service cards clickable
    document.querySelectorAll('.service-card').forEach(card => {
        card.addEventListener('click', function () {
            window.location.href = this.querySelector('a').href;
        });
    });


    // Show alert message
    function showAlert(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.style.position = 'fixed';
        alertDiv.style.top = '20px';
        alertDiv.style.right = '20px';
        alertDiv.style.padding = '15px 20px';
        alertDiv.style.borderRadius = '4px';
        alertDiv.style.color = 'white';
        alertDiv.style.zIndex = '10000';
        alertDiv.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';

        if (type === 'success') {
            alertDiv.style.backgroundColor = '#28a745';
        } else {
            alertDiv.style.backgroundColor = '#dc3545';
        }

        alertDiv.textContent = message;
        document.body.appendChild(alertDiv);

        setTimeout(() => {
            alertDiv.style.opacity = '0';
            setTimeout(() => document.body.removeChild(alertDiv), 300);
        }, 3000);
    }

    // Check if we need to scroll to admin section after page load
    document.addEventListener('DOMContentLoaded', function () {
        const urlParams = new URLSearchParams(window.location.search);
        const scrollToAdmin = urlParams.get('scrollToAdmin');

        if (scrollToAdmin === 'true') {
            const adminSection = document.getElementById('admin-section');
            if (adminSection) {
                // Store the scroll position before the page reloads
                sessionStorage.setItem('shouldScrollToAdmin', 'true');

                setTimeout(() => {
                    window.scrollTo({
                        top: adminSection.offsetTop - 80,
                        behavior: 'instant' // Changed to instant for immediate scroll
                    });
                }, 50);
            }
        }

        // Clear the scroll flag after we've used it
        sessionStorage.removeItem('shouldScrollToAdmin');
    });

    // Modify form submissions to maintain scroll position
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function () {
            if (form.closest('#admin-section')) {
                const scrollField = document.createElement('input');
                scrollField.type = 'hidden';
                scrollField.name = 'scrollToAdmin';
                scrollField.value = 'true';
                form.appendChild(scrollField);
            }
        });
    });

    // Modify pagination links to maintain scroll position
    document.querySelectorAll('.pagination a').forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.includes('/about_hall_man')) {
            // Ensure the URL has the scrollToAdmin parameter
            if (!href.includes('scrollToAdmin=true')) {
                const separator = href.includes('?') ? '&' : '?';
                link.setAttribute('href', href + separator + 'scrollToAdmin=true');
            }
        }
    });


    function toggleVivaStatus(element) {
        const requestId = element.getAttribute('data-id');
        element.style.pointerEvents = 'none'; // Disable further clicks while processing

        fetch(`/provost/seat-requests/${requestId}/toggle-viva`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // Add CSRF token if needed
                // 'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').content
            }
        })
            .then(response => {
                if (!response.ok) throw new Error('Failed to toggle viva status');
                return response.json();
            })
            .then(data => {
                if (data.vivaStatus !== undefined) {
                    element.classList.toggle('filled', data.vivaStatus);
                } else {
                    throw new Error('Invalid response');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('Failed to update viva status', 'error');
            })
            .finally(() => {
                element.style.pointerEvents = 'auto'; // Re-enable clicks
            });
    }


    // ID Card Approval
    function approveIdCard(button) {
        const id = button.getAttribute('data-id');
        if (confirm('Approve this ID card application?')) {
            fetch(`/admin/id-card/approve/${id}`, {
                method: 'POST'
            })
                .then(response => {
                    if (response.ok) {
                        showAlert('ID Card application approved!', 'success');
                        button.closest('tr').remove();
                    } else {
                        throw new Error('Failed to approve');
                    }
                })
                .catch(error => {
                    console.error(error);
                    showAlert('Failed to approve ID card', 'error');
                });
        }
    }

    // Attestation Approval
    function approveAttestation(button) {
        const id = button.getAttribute('data-id');
        if (confirm('Approve this attestation application?')) {
            fetch(`/admin/attestation/approve/${id}`, {
                method: 'POST'
            })
                .then(response => {
                    if (response.ok) {
                        showAlert('Attestation approved!', 'success');
                        button.closest('tr').remove();
                    } else {
                        throw new Error('Failed to approve');
                    }
                })
                .catch(error => {
                    console.error(error);
                    showAlert('Failed to approve attestation', 'error');
                });
        }
    }

    // Lost Certificate Approval
    function approveLostCertificate(button) {
        const id = button.getAttribute('data-id');
        if (confirm('Approve this lost certificate application?')) {
            fetch(`/admin/lost-certificate/approve/${id}`, {
                method: 'POST'
            })
                .then(response => {
                    if (response.ok) {
                        showAlert('Lost certificate approved!', 'success');
                        button.closest('tr').remove();
                    } else {
                        throw new Error('Failed to approve');
                    }
                })
                .catch(error => {
                    console.error(error);
                    showAlert('Failed to approve lost certificate', 'error');
                });
        }
    }

    // View GD for Lost Certificate
    function viewGD(button) {
        const gdPath = button.getAttribute('data-gdpath');
        window.open(`/uploads/${gdPath}`, '_blank');
    }


    function searchToken(event) {
        event.preventDefault();
        const tokenNumber = document.getElementById('tokenNumber').value.trim();
        const tokenResult = document.getElementById('tokenResult');
        const tokenDetails = document.getElementById('tokenDetails');

        if (!tokenNumber) {
            showAlert('Please enter a token number', 'error');
            return;
        }

        fetch(`/admin/tokens/search?tokenNumber=${encodeURIComponent(tokenNumber)}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Token not found');
                }
                return response.json();
            })
            .then(token => {
                tokenResult.style.display = 'block';
                tokenDetails.innerHTML = `
            <p><strong>Token Number:</strong> ${token.tokenNumber}</p>
            <p><strong>Student ID:</strong> ${token.studentId}</p>
            <p><strong>Hall Name:</strong> ${token.hallName}</p>
            <p><strong>Meal Type:</strong> ${token.mealType}</p>
            <p><strong>Meal Date:</strong> ${token.mealDate}</p>
            <p><strong>Status:</strong> ${token.verified ? 'Verified' : 'Not Verified'}</p>
            ${!token.verified ? `<button onclick="verifyToken('${token.id}')"
                style="padding: 8px 16px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                Verify Token
            </button>` : ''}
        `;
            })
            .catch(error => {
                tokenResult.style.display = 'block';
                tokenDetails.innerHTML = `<p style="color: #dc3545;">${error.message}</p>`;
            });
    }

    function verifyToken(tokenId) {
        if (confirm('Are you sure you want to verify this token?')) {
            fetch(`/admin/tokens/verify/${tokenId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        showAlert('Token verified successfully!', 'success');
                        // Refresh the token details without trying to resubmit the form
                        const tokenDetails = document.getElementById('tokenDetailContent');
                        if (tokenDetails) {
                            const statusElement = tokenDetails.querySelector('p:nth-child(6)');
                            if (statusElement) {
                                statusElement.innerHTML = '<strong>Status:</strong> ✅ Verified';
                            }

                            // Remove the verify button
                            const verifyBtn = tokenDetails.querySelector('button');
                            if (verifyBtn) {
                                verifyBtn.remove();
                            }
                        }
                    } else {
                        throw new Error('Failed to verify token');
                    }
                })
                .catch(error => {
                    console.error(error);
                    showAlert(error.message, 'error');
                });
        }
    }

    let currentTokenSearchQuery = '';

    function liveTokenSearch() {
        const query = document.getElementById('tokenSearchInput').value.trim().toUpperCase();
        const resultsDiv = document.getElementById('tokenSearchResults');
        const detailsDiv = document.getElementById('tokenDetails');

        if (query === '') {
            resultsDiv.style.display = 'none';
            resultsDiv.innerHTML = '';
            detailsDiv.style.display = 'none';
            currentTokenSearchQuery = '';
            return;
        }

        // Only search if the query has changed
        if (query === currentTokenSearchQuery) return;
        currentTokenSearchQuery = query;

        fetch(`/admin/tokens/search-live?query=${encodeURIComponent(query)}`)
            .then(response => {
                if (!response.ok) throw new Error('Search failed');
                return response.json();
            })
            .then(tokens => {
                resultsDiv.innerHTML = '';

                if (tokens.length > 0) {
                    resultsDiv.style.display = 'block';

                    tokens.forEach(token => {
                        const tokenElement = document.createElement('div');
                        tokenElement.className = 'result-item';
                        tokenElement.style.padding = '10px';
                        tokenElement.style.borderBottom = '1px solid #eee';
                        tokenElement.style.cursor = 'pointer';
                        tokenElement.innerHTML = `
                        <strong>${token.tokenNumber}</strong> -
                        ${token.studentId} -
                        ${token.mealType} (${token.mealDate})
                    `;

                        tokenElement.addEventListener('click', () => {
                            showTokenDetails(token);
                            resultsDiv.style.display = 'none';
                            document.getElementById('tokenSearchInput').value = token.tokenNumber;
                        });

                        resultsDiv.appendChild(tokenElement);
                    });
                } else {
                    resultsDiv.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Search error:', error);
                resultsDiv.style.display = 'none';
            });
    }

    function showTokenDetails(token) {
        const detailsDiv = document.getElementById('tokenDetails');
        const detailContent = document.getElementById('tokenDetailContent');

        detailContent.innerHTML = `
        <p><strong>Token Number:</strong> ${token.tokenNumber}</p>
        <p><strong>Student ID:</strong> ${token.studentId}</p>
        <p><strong>Hall Name:</strong> ${token.hallName}</p>
        <p><strong>Meal Type:</strong> ${token.mealType}</p>
        <p><strong>Meal Date:</strong> ${token.mealDate}</p>
        <p><strong>Status:</strong> ${token.verified ? '✅ Verified' : '❌ Not Verified'}</p>
        ${!token.verified ? `
        <button onclick="verifyToken('${token.id}')"
            style="padding: 8px 16px; background-color: #28a745; color: white;
                   border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">
            Verify Token
        </button>` : ''}
    `;

        detailsDiv.style.display = 'block';
    }

    // Close search results when clicking outside
    document.addEventListener('click', function (e) {
        if (!e.target.closest('#tokenSearchResults') && e.target.id !== 'tokenSearchInput') {
            document.getElementById('tokenSearchResults').style.display = 'none';
        }
    });

    // Add this to your script section
    function generatePendingSeatPDF() {
        fetch('/admin/seat-requests/generate-pdf', {
            method: 'GET',
            headers: {
                'Accept': 'application/pdf'
            }
        })
            .then(response => {
                if (!response.ok) throw new Error('Failed to generate PDF');
                return response.blob();
            })
            .then(blob => {
                // Create a blob URL for the PDF
                const url = window.URL.createObjectURL(blob);

                // Create a temporary anchor element to trigger download
                const a = document.createElement('a');
                a.href = url;
                a.download = 'pending_seat_applications.pdf';
                document.body.appendChild(a);
                a.click();

                // Clean up
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('Failed to generate PDF', 'error');
            });
    }

</script>
</body>
</html>


